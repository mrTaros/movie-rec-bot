# üé¨ Movie Rec Bot

Telegram-–±–æ—Ç –¥–ª—è –Ω–µ–¥–µ–ª—å–Ω—ã—Ö –ø–æ–¥–±–æ—Ä–æ–∫ —Ñ–∏–ª—å–º–æ–≤ –∏ —Å–µ—Ä–∏–∞–ª–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–µ–Ω–¥–æ–≤ TMDB.

## üìã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–¥–±–æ—Ä–∫–∏ –∫–∞–∂–¥—É—é –ø—è—Ç–Ω–∏—Ü—É –≤ 18:00 –ú–°–ö
- ‚úÖ –†—É—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã `/recommend` –∏ `/more`
- ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –∫ Topics (—Ç–µ–º–∞–º) –≤ Telegram –≥—Ä—É–ø–ø–∞—Ö
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏–Ω–¥–∏–π—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ–º —Ñ–∏–ª—å–º—ã 30 –¥–Ω–µ–π)
- ‚úÖ Rate limiting (1 –∫–æ–º–∞–Ω–¥–∞ –≤ 30 —Å–µ–∫—É–Ω–¥)
- ‚úÖ Owner-only –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
cp .env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env` —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

```env
# Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É @BotFather)
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# –í–∞—à Telegram User ID (–ø–æ–ª—É—á–∏—Ç—å —É @userinfobot)
OWNER_USER_ID=123456789

# TMDB API Authorization (–ø–æ–ª—É—á–∏—Ç—å –Ω–∞ https://www.themoviedb.org/)
TMDB_AUTH=Bearer eyJhbGci...–≤–∞—à_–¥–ª–∏–Ω–Ω—ã–π_—Ç–æ–∫–µ–Ω

# –û—Å—Ç–∞–ª—å–Ω–æ–µ –º–æ–∂–Ω–æ –Ω–µ –º–µ–Ω—è—Ç—å
TIMEZONE=Europe/Moscow
DB_PATH=./data/bot.db
LOG_LEVEL=info
```

### 3. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** (—Å hot reload):
```bash
npm run dev
```

**–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞**:
```bash
npm run build
npm start
```

---

## üîë –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∫–ª—é—á–∏

### Telegram Bot Token

1. –ù–∞–π–¥–∏—Ç–µ –≤ Telegram: **@BotFather**
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É: `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º (–ø—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è –∏ username)
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è

### Telegram User ID

1. –ù–∞–π–¥–∏—Ç–µ –≤ Telegram: **@userinfobot**
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É: `/start`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à ID (—á–∏—Å–ª–æ)

### TMDB API Token

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://www.themoviedb.org/
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings ‚Üí API**
3. –ó–∞–ø—Ä–æ—Å–∏—Ç–µ **API Read Access Token** (v4 auth)
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Bearer —Ç–æ–∫–µ–Ω** —Ü–µ–ª–∏–∫–æ–º (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `eyJ...`)

---

## üì± –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### Owner-only –∫–æ–º–∞–Ω–¥—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞):

- `/bind_here` ‚Äî –ø—Ä–∏–≤—è–∑–∞—Ç—å –±–æ—Ç–∞ –∫ —Ç–µ–∫—É—â–µ–º—É —Ç–æ–ø–∏–∫—É
- `/unbind` ‚Äî —Å–Ω—è—Ç—å –ø—Ä–∏–≤—è–∑–∫—É
- `/start_bot` ‚Äî –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ-—Ä–µ–∂–∏–º (–ø–æ–¥–±–æ—Ä–∫–∏ –ø–æ –ø—è—Ç–Ω–∏—Ü–∞–º)
- `/stop_bot` ‚Äî –≤—ã–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ-—Ä–µ–∂–∏–º
- `/status` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞

### –ü—É–±–ª–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (–¥–ª—è –≤—Å–µ—Ö):

- `/recommend` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–±–æ—Ä–∫—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å
- `/more` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –µ—â—ë –æ–¥–Ω—É –ø–æ–¥–±–æ—Ä–∫—É

---

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π A: –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç–µ–º–µ –≥—Ä—É–ø–ø—ã

1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ–º—É –≤ –≥—Ä—É–ø–ø–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º **"—Ñ–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã"**
2. –ó–∞–π–¥–∏—Ç–µ –≤ —ç—Ç—É —Ç–µ–º—É
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/bind_here` (—Ç–æ–ª—å–∫–æ owner)
4. –¢–µ–ø–µ—Ä—å:
   - –ê–≤—Ç–æ–ø–æ–¥–±–æ—Ä–∫–∏ –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤ —ç—Ç—É —Ç–µ–º—É
   - –ö–æ–º–∞–Ω–¥—ã `/recommend` –∏ `/more` —Ä–∞–±–æ—Ç–∞—é—Ç **—Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–π —Ç–µ–º–µ**

### –°—Ü–µ–Ω–∞—Ä–∏–π B: –ë–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ (–ª–∏—á–∫–∞)

1. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É –≤ –ª–∏—á–∫—É
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/recommend` –∏–ª–∏ `/more`
3. –ê–≤—Ç–æ–ø–æ–¥–±–æ—Ä–∫–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã) –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤ –ª–∏—á–∫—É

---

## üõ†Ô∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
movie-rec-bot/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.ts             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ ENV
‚îÇ   ‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot.ts            # grammY instance
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands.ts       # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ binding.ts        # –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ Topics
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ middleware/       # Middleware (auth, rate limit)
‚îÇ   ‚îú‚îÄ‚îÄ jobs/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ weeklyDigest.ts   # Cron job (–ø—è—Ç–Ω–∏—Ü–∞ 18:00)
‚îÇ   ‚îú‚îÄ‚îÄ providers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tmdb.ts           # TMDB API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ strategies/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ popularThisWeek.ts # –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ rules/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filters.ts        # –§–∏–ª—å—Ç—Ä –∏–Ω–¥–∏–π—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dedup.ts          # –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è 30 –¥–Ω–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ formatters/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ digestHtml.ts     # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ HTML —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.ts       # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schema.ts         # –°—Ö–µ–º–∞ –ë–î –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ logger.ts         # Pino –ª–æ–≥–≥–µ—Ä
‚îÇ       ‚îî‚îÄ‚îÄ types.ts          # TypeScript —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ bot.db                # SQLite –±–∞–∑–∞ (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ .env                      # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é)
‚îú‚îÄ‚îÄ .env.example              # –®–∞–±–ª–æ–Ω .env
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ README.md
```

---

## üêõ Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –≤ –≥—Ä—É–ø–ø–µ

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø—Ä–∏–≤—è–∑–∞–Ω –ª–∏ –±–æ—Ç –∫–æ–º–∞–Ω–¥–æ–π `/bind_here`
- –ï—Å–ª–∏ –ø—Ä–∏–≤—è–∑–∞–Ω, –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç **—Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–π —Ç–µ–º–µ**

### –û—à–∏–±–∫–∞ "Invalid environment variables"

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª `.env` —Å–æ–∑–¥–∞–Ω –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω
- –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `BOT_TOKEN`, `OWNER_USER_ID`, `TMDB_AUTH`

### "TMDB API error" –∏–ª–∏ "–ò—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TMDB_AUTH` —Ç–æ–∫–µ–Ω (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `Bearer`)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω (–Ω–µ –∏—Å—Ç—ë–∫)

### –ë–æ—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–ø–æ–¥–±–æ—Ä–∫–∏

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≤–∫–ª—é—á—ë–Ω –ª–∏ –∞–≤—Ç–æ-—Ä–µ–∂–∏–º: `/status`
- –ï—Å–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω: `/start_bot`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –ø—Ä–∏–≤—è–∑–∫–∞ (–±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç)

---

## üì¶ –î–µ–ø–ª–æ–π –Ω–∞ Render.com

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ GitHub
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π **Web Service** –Ω–∞ Render.com
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ:
   - **Build Command**: `npm install && npm run build`
   - **Start Command**: `npm start`
5. –î–æ–±–∞–≤—å—Ç–µ **Environment Variables** –∏–∑ `.env`
6. Deploy!

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

–°–æ–∑–¥–∞–Ω–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ–¥–µ–ª—å–Ω—ã–º–∏ –ø–æ–¥–±–æ—Ä–∫–∞–º–∏ —Ñ–∏–ª—å–º–æ–≤ –∏ —Å–µ—Ä–∏–∞–ª–æ–≤.
