# Telegram Bot: Weekly Movies & Series Digest (based on Movie-Magic) ‚Äî PRD + Build Instructions for Cursor

**Single source of truth.** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞ —Å—Ç—Ä–æ–≥–æ –ø–æ —ç—Ç–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É.  
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–ø–∞–º–∞, –ø—Ä–æ—Å—Ç–∞—è —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.  
–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –∏ API ‚Äî **–∫–∞–∫ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Movie-Magic**: https://github.com/itsyaba/Movie-Magic (Cursor –¥–æ–ª–∂–µ–Ω –∏–∑—É—á–∏—Ç—å –∫–æ–¥/README –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ API –∏ –ø–æ–¥—Ö–æ–¥ –∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏).

---

## 1) –¶–µ–ª—å
Telegram-–±–æ—Ç –ø—Ä–∏—Å—ã–ª–∞–µ—Ç **–ø–æ–¥–±–æ—Ä–∫—É –∏–∑ 3 —Ñ–∏–ª—å–º–æ–≤ –∏ 3 —Å–µ—Ä–∏–∞–ª–æ–≤**:
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ **–∫–∞–∂–¥—É—é –ø—è—Ç–Ω–∏—Ü—É –≤ 18:00 –ú–°–ö**
- –∏ **–ø–æ –∫–æ–º–∞–Ω–¥–µ** (–¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

–ë–æ—Ç –º–æ–∂–µ—Ç:
- –±—ã—Ç—å **–ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º** –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–µ–º–µ (Topic) –≤ –≥—Ä—É–ø–ø–µ –∏ –ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç—É–¥–∞
- —Ä–∞–±–æ—Ç–∞—Ç—å **–±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏** (–≤ –ª–∏—á–Ω–æ–º —á–∞—Ç–µ —Å –±–æ—Ç–æ–º)

---

## 2) –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π A ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç–µ–º–µ –≥—Ä—É–ø–ø—ã (Topics)
- –í –≥—Ä—É–ø–ø–µ –µ—Å—Ç—å —Ç–µ–º–∞: **"—Ñ–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã"** (—Å—Ç—Ä–æ–≥–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è).
- –ë–æ—Ç –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ —Ç–µ–º–µ owner-–∫–æ–º–∞–Ω–¥–æ–π **–≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π —Ç–µ–º—ã**:
  - `/bind_here` (owner-only)
- –ü–æ—Å–ª–µ –ø—Ä–∏–≤—è–∑–∫–∏:
  - **–∞–≤—Ç–æ-–ø–æ–¥–±–æ—Ä–∫–∏** –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —ç—Ç—É —Ç–µ–º—É
  - **—Ä—É—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã** –±–æ—Ç –∏—Å–ø–æ–ª–Ω—è–µ—Ç **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞–ø–∏—Å–∞–Ω–∞ –≤ —ç—Ç–æ–π —Ç–µ–º–µ**, –∏–Ω–∞—á–µ **–Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –≤–æ–æ–±—â–µ** (—á—Ç–æ–±—ã –Ω–µ —Ñ–ª—É–¥–∏—Ç—å)

### –°—Ü–µ–Ω–∞—Ä–∏–π B ‚Äî –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏
- –ï—Å–ª–∏ –ø—Ä–∏–≤—è–∑–∫–∏ –Ω–µ—Ç, –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ª–∏—á–∫–µ:
  - –∞–≤—Ç–æ-–ø–æ–¥–±–æ—Ä–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è **–≤ —á–∞—Ç —Å –±–æ—Ç–æ–º (–ª–∏—á–∫—É)**
  - –∫–æ–º–∞–Ω–¥—ã `/recommend` –∏ `/more` –≤ –ª–∏—á–∫–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø–æ–¥–±–æ—Ä–∫—É
- –ï—Å–ª–∏ API/–∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
  - –≤ –ª–∏—á–∫–µ –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç: **"–ò—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."**

---

## 3) –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 3.1 –ö–æ–º–∞–Ω–¥—ã
**Owner-only:**
- `/bind_here` ‚Äî –ø—Ä–∏–≤—è–∑–∞—Ç—å –±–æ—Ç–∞ –∫ —Ç–µ–∫—É—â–µ–º—É Topic (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å `chat_id` + `thread_id`)
- `/unbind` ‚Äî —Å–Ω—è—Ç—å –ø—Ä–∏–≤—è–∑–∫—É
- `/start_bot` ‚Äî –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ-—Ä–µ–∂–∏–º
- `/stop_bot` ‚Äî –≤—ã–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ-—Ä–µ–∂–∏–º
- `/status` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å (enabled/bound/next run)

**–î–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- `/recommend` ‚Äî –ø—Ä–∏—Å–ª–∞—Ç—å –ø–æ–¥–±–æ—Ä–∫—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å
- `/more` ‚Äî –ø—Ä–∏—Å–ª–∞—Ç—å –µ—â—ë –æ–¥–Ω—É –Ω–æ–≤—É—é –ø–æ–¥–±–æ—Ä–∫—É

### 3.2 –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- –ê–≤—Ç–æ-—Ä–µ–∂–∏–º: **–∫–∞–∂–¥—É—é –ø—è—Ç–Ω–∏—Ü—É 18:00 –ø–æ –ú–°–ö** (`Europe/Moscow`)
- –ê–≤—Ç–æ-–ø–æ–¥–±–æ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:
  - –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∏–≤—è–∑–∫–∞ ‚Üí –≤ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—É—é —Ç–µ–º—É
  - –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏ ‚Üí –≤ –ª–∏—á–∫—É (—á–∞—Ç —Å –±–æ—Ç–æ–º)

### 3.3 –õ–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–±–æ—Ä–∫–∏
- –û—Å–Ω–æ–≤–∞: **"popular this week"**
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç/–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç API –≤ Movie-Magic:
  - Cursor –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç "popular this week" —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ API (–Ω–∞–ø—Ä–∏–º–µ—Ä trending/week vs popular + —Ñ–∏–ª—å—Ç—Ä—ã)
- –í—ã–¥–∞—á–∞:
  - **3 —Ñ–∏–ª—å–º–∞** + **3 —Å–µ—Ä–∏–∞–ª–∞**
- –Ø–∑—ã–∫–∏/—Å—Ç—Ä–∞–Ω—ã: **–ª—é–±—ã–µ**, –∫—Ä–æ–º–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –ø–æ –ò–Ω–¥–∏–∏ (—Å–º. –Ω–∏–∂–µ)

### 3.4 –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω–¥–∏–π—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
–ò—Å–∫–ª—é—á–∞—Ç—å —Ç–∞–π—Ç–ª—ã, –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ:
- `origin_country == IN` (–µ—Å–ª–∏ –ø–æ–ª–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- `production_countries` —Å–æ–¥–µ—Ä–∂–∏—Ç `IN` (–µ—Å–ª–∏ –ø–æ–ª–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- `original_language` –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∏–Ω–¥–∏–π—Å–∫–∏–º —è–∑—ã–∫–∞–º (–µ—Å–ª–∏ –ø–æ–ª–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç; —Å–ø–∏—Å–æ–∫ —è–∑—ã–∫–æ–≤ –≤—ã–±—Ä–∞—Ç—å –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏/–¥–∞–Ω–Ω—ã–º API)

**–í–∞–∂–Ω–æ:** —Ç–æ—á–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π/—Ñ—É–Ω–∫—Ü–∏–π —É—Ç–æ—á–Ω–∏—Ç—å –ø–æ API Movie-Magic –∏ –µ–≥–æ SDK/–∑–∞–ø—Ä–æ—Å–∞–º.

### 3.5 IMDb —Å—Å—ã–ª–∫–∏
- –ï—Å–ª–∏ API –æ—Ç–¥–∞—ë—Ç `imdb_id` –Ω–∞–ø—Ä—è–º—É—é –≤ –±–∞–∑–æ–≤–æ–º –æ—Ç–≤–µ—Ç–µ ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–π—Ç–ª–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π HTML-—Å—Å—ã–ª–∫–æ–π –Ω–∞ IMDb:
  - `https://www.imdb.com/title/<imdb_id>/`
- –ï—Å–ª–∏ `imdb_id` **–Ω–µ—Ç –≤ –¥–∞–Ω–Ω—ã—Ö** –∏ –µ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø. –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî **—Å—Å—ã–ª–∫—É –Ω–µ –¥–µ–ª–∞—Ç—å**, –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç –Ω–∞–∑–≤–∞–Ω–∏—è (–±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤).

---

## 4) –ê–Ω—Ç–∏—Å–ø–∞–º –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è (–∑–∞—â–∏—Ç–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º)
> –≠—Ç–æ –Ω–µ "MUST", –Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–∞–∫ –∑–∞—â–∏—Ç–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –∏ –æ–ø–∏—Å–∞–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.

### 4.1 Rate limit –Ω–∞ –∫–æ–º–∞–Ω–¥—ã
- –õ–∏–º–∏—Ç: **–Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 30 —Å–µ–∫—É–Ω–¥**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ: per-user –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ —á–∞—Ç–∞/—Ç–µ–º—ã
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞: –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç (–∏–ª–∏ –º–æ–ª—á–∞–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ ‚Äî –Ω–∞ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ; –≤ –ª–∏—á–∫–µ –ª—É—á—à–µ –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç)

### 4.2 –î–µ–¥—É–ø –Ω–∞ 30 –¥–Ω–µ–π (–∏ –¥–ª—è –∞–≤—Ç–æ, –∏ –¥–ª—è —Ä—É—á–Ω—ã—Ö)
- –ù–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å —Ç–∞–π—Ç–ª—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö **30 –¥–Ω–µ–π**
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ **ID** (ID –∏–∑ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ API)
- –î–µ–¥—É–ø –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è:
  - –∫ –∞–≤—Ç–æ-–ø—è—Ç–Ω–∏—á–Ω–æ–π –ø–æ–¥–±–æ—Ä–∫–µ
  - –∫ —Ä—É—á–Ω—ã–º `/recommend` –∏ `/more`

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π scope –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã:** –¥–µ–¥—É–ø –≥–ª–æ–±–∞–ª—å–Ω—ã–π –Ω–∞ –∏–Ω—Å—Ç–∞–Ω—Å –±–æ—Ç–∞ (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —á–∞—Ç–∞), —á—Ç–æ–±—ã —Ç–µ—Å—Ç—ã –Ω–µ "—Å—ä–µ–¥–∞–ª–∏" –≤—ã–¥–∞—á—É –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π —Ç–µ–º—ã.

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤/–¥–µ–¥—É–ø–∞ –Ω–µ —É–¥–∞—ë—Ç—Å—è –Ω–∞–±—Ä–∞—Ç—å 3+3:
- –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–µ–Ω—å—à–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä 2+3) –∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å

---

## 5) –ü–æ–≤–µ–¥–µ–Ω–∏–µ –≤ –æ—à–∏–±–∫–∞—Ö (fail-closed + UX)
- –ï—Å–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫/API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
  - –∞–≤—Ç–æ-—Ä–µ–∂–∏–º: **–Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å**, —Ç–æ–ª—å–∫–æ –ª–æ–≥
  - —Ä—É—á–Ω–æ–π —Ä–µ–∂–∏–º:
    - –≤ –ª–∏—á–∫–µ: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å **"–ò—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."**
    - –≤ –≥—Ä—É–ø–ø–µ (–≤ —Ç–µ–º–µ "—Ñ–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã"): –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ 1 —Ä–∞–∑ (–±–µ–∑ —Ä–µ—Ç—Ä–∞–µ–≤/—Å–ø–∞–º–∞)
- –ü–∞—Ä—Å–∏–Ω–≥/—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ø–∞–ª–æ: –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–¥–±–æ—Ä–∫—É, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å

---

## 6) –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π (Telegram HTML)

### 6.1 –Ø–∑—ã–∫ –∏ —Ñ–æ—Ä–º–∞—Ç
- –Ø–∑—ã–∫: —Ä—É—Å—Å–∫–∏–π (–Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∞–π—Ç–ª–æ–≤ –∫–∞–∫ –≤ API, –æ–±—ã—á–Ω–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ/–ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
- `parse_mode = HTML`
- MVP-—Ñ–æ—Ä–º–∞—Ç: **—Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏—è** (–±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏–π), —Å–ø–∏—Å–∫–æ–º
- –î–≤–µ —Å–µ–∫—Ü–∏–∏:
  - **üé¨ Movies**
  - **üì∫ Series**

### 6.2 –®–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è (–ø—Ä–∏–º–µ—Ä)
```text
<b>üé¨ Movies</b>
‚Ä¢ <a href="https://www.imdb.com/title/tt1234567/">Movie Title</a>
‚Ä¢ Movie Title 2
‚Ä¢ Movie Title 3

<b>üì∫ Series</b>
‚Ä¢ Series Title
‚Ä¢ Series Title 2
‚Ä¢ Series Title 3
```

---

## 7) –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (–ø—Ä–æ—Å—Ç–∞—è —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

### 7.1 Stack
- Node.js 20+
- TypeScript
- Telegram: grammY
- Scheduler: node-cron (timezone Europe/Moscow)
- DB: SQLite (better-sqlite3)
- HTTP: undici
- Dates: luxon
- Logging: pino

### 7.2 –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
```text
src/
  index.ts
  config.ts
  bot/
    commands.ts        # handlers + auth guard (owner only)
    binding.ts         # bind/unbind helpers
  jobs/
    weeklyDigest.ts    # cron Friday 18:00 MSK
  providers/
    movieMagicApi.ts   # –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API –∏–∑ Movie-Magic
  strategies/
    popularThisWeek.ts # –≤—ã–±–æ—Ä–∫–∞ "popular this week"
  rules/
    dedup.ts           # 30-day dedup by ids
    rateLimit.ts       # 1 per 30s
    filters.ts         # India exclusion
  formatters/
    digestHtml.ts      # HTML escaping + template
  db/
    sqlite.ts
    schema.ts
```

### 7.3 Provider (–∫–ª—é—á–µ–≤–∞—è –∑–∞–¥–∞—á–∞ Cursor)
- –ò–∑—É—á–∏—Ç—å Movie-Magic:
  - –∫–∞–∫–æ–π API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  - –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
  - –∫–∞–∫–∏–µ endpoints –¥–∞—é—Ç movies + tv
  - –∫–∞–∫–∏–µ –ø–æ–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è imdb_id / —Å—Ç—Ä–∞–Ω—ã / —è–∑—ã–∫–∏
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å provider, –∫–æ—Ç–æ—Ä—ã–π –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Ç–∏–ø–∞–º:
  - `Movie { id, title, imdbId?, originCountry?, productionCountries?, originalLanguage? }`
  - `Series { id, title, imdbId?, originCountry?, productionCountries?, originalLanguage? }`

---

## 8) –•—Ä–∞–Ω–∏–ª–∏—â–µ (SQLite)

### 8.1 –¢–∞–±–ª–∏—Ü—ã (MVP)
- `settings(key TEXT PRIMARY KEY, value TEXT)`
  - `enabled` (true/false)
  - `target_chat_id` (nullable)
  - `target_thread_id` (nullable)
  - `owner_user_id`
- `sent_items(item_id TEXT PRIMARY KEY, sent_at INTEGER, item_type TEXT)`  
  item_type: movie|series  
  (–¥–ª—è –¥–µ–¥—É–ø–∞ 30 –¥–Ω–µ–π)
- `rate_limit(key TEXT PRIMARY KEY, last_used_at INTEGER)`  
  key: `<chatId>:<userId>:recommend` (–ø—Ä–∏–º–µ—Ä)

---

## 9) –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (ENV)
Cursor –¥–æ–ª–∂–µ–Ω –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ Movie-Magic, –Ω–æ –º–∏–Ω–∏–º—É–º:
- `BOT_TOKEN`
- `OWNER_USER_ID`
- `TIMEZONE=Europe/Moscow`
- `MOVIE_API_KEY` / `TMDB_TOKEN` / etc ‚Äî **–∫–∞–∫ –≤ Movie-Magic** (–Ω–∞–∑–≤–∞–Ω–∏–µ —É—Ç–æ—á–Ω–∏—Ç—å –ø–æ —Ä–µ–ø–æ)

---

## 10) Acceptance criteria (Definition of Done)
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ –ª–∏—á–∫–µ –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏:
  - `/recommend` ‚Üí 3+3 (–∏–ª–∏ –º–µ–Ω—å—à–µ –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ)
  - –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí "–ò—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ –≥—Ä—É–ø–ø–µ —Å Topics:
  - `/bind_here` –≤–Ω—É—Ç—Ä–∏ —Ç–µ–º—ã "—Ñ–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã" —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç binding
  - –∫–æ–º–∞–Ω–¥—ã –≤ –¥—Ä—É–≥–∏—Ö —Ç–µ–º–∞—Ö ‚Üí **–Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞**
- –ê–≤—Ç–æ-–ø–æ–¥–±–æ—Ä–∫–∞ –≤ –ø—è—Ç–Ω–∏—Ü—É 18:00 –ú–°–ö:
  - –µ—Å–ª–∏ enabled=true
  - –µ—Å–ª–∏ –µ—Å—Ç—å binding ‚Üí –≤ —Ç–µ–º—É
  - –µ—Å–ª–∏ –Ω–µ—Ç binding ‚Üí –≤ –ª–∏—á–∫—É
- –ò—Å–∫–ª—é—á–∞–µ—Ç –∏–Ω–¥–∏–π—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º —Ñ–∏–ª—å—Ç—Ä–∞
- –ù–µ –¥–µ–ª–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Ä–∞–¥–∏ imdb_id
- –î–µ–¥—É–ø –Ω–∞ 30 –¥–Ω–µ–π –ø–æ ID —Ä–∞–±–æ—Ç–∞–µ—Ç (–∏ –¥–ª—è –∞–≤—Ç–æ, –∏ –¥–ª—è —Ä—É—á–Ω—ã—Ö)
- Rate-limit 1 —Ä–∞–∑ –≤ 30 —Å–µ–∫—É–Ω–¥ —É–∫–∞–∑–∞–Ω –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –∑–∞—â–∏—Ç–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º (–±–µ–∑ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è)

---

## 11) –ü—Ä–∞–≤–∏–ª–æ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—á—Ç–æ–±—ã –Ω–µ –∑–∞—Ö–ª–∞–º–ª—è—Ç—å –ø—Ä–æ–µ–∫—Ç)
- –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ markdown-–ª–æ–≥–∏ "—á—Ç–æ –∏–∑–º–µ–Ω–∏–ª" –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞.
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–ø–∏—Å—ã–≤–∞—Ç—å –≤ –æ—Ç–≤–µ—Ç–µ –∏ –≤ commit message.
- –û–±–Ω–æ–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö core docs (README.md, docs/PRD.md).

---

## 12) –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω)
- **Runtime**: Node.js 20+ —Å TypeScript 5.x
- **Telegram**: grammY (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ node-telegram-bot-api)
- **Scheduler**: node-cron + luxon (timezone Europe/Moscow)
- **Database**: better-sqlite3 (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è SQLite)
- **HTTP**: –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π fetch (Node.js 18+)
- **Validation**: zod (–¥–ª—è ENV –∏ —Ç–∏–ø–æ–≤)
- **Logging**: pino + pino-pretty (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- **Dev**: tsx (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å hot reload)

### API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- **TMDB API v3**: https://api.themoviedb.org/3/
- **Endpoints**:
  - `/trending/movie/week` ‚Äî —Ç—Ä–µ–Ω–¥–æ–≤—ã–µ —Ñ–∏–ª—å–º—ã –∑–∞ –Ω–µ–¥–µ–ª—é
  - `/trending/tv/week` ‚Äî —Ç—Ä–µ–Ω–¥–æ–≤—ã–µ —Å–µ—Ä–∏–∞–ª—ã –∑–∞ –Ω–µ–¥–µ–ª—é
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: Bearer token –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization`
- **IMDb —Å—Å—ã–ª–∫–∏**: –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã (—Ç.–∫. `imdb_id` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ trending endpoints –±–µ–∑ –¥–æ–ø. –∑–∞–ø—Ä–æ—Å–æ–≤)

### –§–∏–ª—å—Ç—Ä—ã –∏ –ø—Ä–∞–≤–∏–ª–∞
- **–ò–Ω–¥–∏–π—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç**: –∏—Å–∫–ª—é—á–∞–µ–º –ø–æ `original_language` (hi, ta, te, ml, kn, bn, mr, pa, gu, or, as, ur, sa) –∏ `origin_country` (IN)
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: –≥–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞ 30 –¥–Ω–µ–π –ø–æ ID —Ñ–∏–ª—å–º–∞/—Å–µ—Ä–∏–∞–ª–∞
- **Rate limiting**: per-user 1 –∫–æ–º–∞–Ω–¥–∞ –≤ 30 —Å–µ–∫—É–Ω–¥ (–∫–ª—é—á: `chatId:userId:action`)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```sql
-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ (enabled, target_chat_id, target_thread_id)
settings(key TEXT PRIMARY KEY, value TEXT)

-- –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ items (–¥–ª—è –¥–µ–¥—É–ø–∞)
sent_items(item_id TEXT PRIMARY KEY, item_type TEXT, sent_at INTEGER)

-- Rate limiting
rate_limit(key TEXT PRIMARY KEY, last_used_at INTEGER)
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- **Graceful shutdown**: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ (–ë–î, cron, bot)
- **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞**: —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ (>30 –¥–Ω–µ–π –¥–ª—è sent_items, >1 —á–∞—Å –¥–ª—è rate_limit)
- **Fail-closed**: –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API –Ω–µ —Å–ø–∞–º–∏–º, —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É–µ–º
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º –∏ –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è

### Deployment –Ω–∞ Render.com
- **Long polling** (–Ω–µ webhook) ‚Äî –Ω–µ —Ç—Ä–µ–±—É–µ—Ç web server
- **Persisted SQLite** —á–µ—Ä–µ–∑ volume –≤ ./data/
- **Environment variables** —á–µ—Ä–µ–∑ Render UI

### Scripts
- `npm run dev` ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å hot reload (tsx)
- `npm run build` ‚Äî –∫–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript ‚Üí dist/
- `npm start` ‚Äî –∑–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–±–æ—Ä–∫–∏
- `npm run typecheck` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –±–µ–∑ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
